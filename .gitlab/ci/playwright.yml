playwright-tests:
  stage: test
  image: node:lts
  rules:
    # Only run the tests when the pipeline is triggered by a merge request to the main branch
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_TARGET_BRANCH_NAME == "main"'
  script:
    - npm install -g pnpm
    - pnpm install
    - pnpm exec playwright install --with-deps
    - pnpm exec playwright test
  artifacts:
    # Save the artifacts (the report) to the job's artifacts
    when: always
    paths:
      - playwright-report/
    expire_in: 30 days